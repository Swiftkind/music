{% extends 'playlist/base.html' %} 

{% block content %}

<div class="container-fluid">
  <div class="row">
  <div class="col-md-3">

      <form method = "post" id = "addsong">
        {% csrf_token %}
            <label>Title:</label><input type = "text" name ="title"><br>
            <label>Link:</label>{{form.link}}<br>
            <button type = "submit" >Add Song To Playlist</button>
        </form>
    {{playlist.title}}<br>
    {{playlist.description}}<br>
    {{playlist.date_created}}<br>
    {{playlist.date_updated}}<br>
  </div>

<div class= "col-md-6">
    <div class="card">
      <div class="card-block">
        <h3 class="card-title">NOW PLAYING</h3>
        <h6 class="card-subtitle mb-2 text-muted">Song Title</h6>
        <a href="#" class="card-link">Song Link</a>
        <a href = "#" class="card-link"> User </a>
        <br>
            <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
              <div class="btn-group mr-2" role="group" aria-label="First group">
                <button type="button" class="btn btn-secondary">Previous</button>
                <button type="button" class="btn btn-secondary">Next</button>
              </div>

              <div class="btn-group mr-2" role="group" aria-label="Second group">
                <button type="button" class="btn btn-secondary">Play</button>
                <button type="button" class="btn btn-secondary">Pause</button>
                <button type="button" class="btn btn-secondary">Stop</button>
              </div>
            </div>
                  </div>
    </div>
</div>

<div class = "col-md-3">
    <div class="card" id = "songlist">
        <br>
        {% for song in songlist %}
            <div class="card-block">
                <span>
                <a href="{% url 'playlist_songdetail' playlist.id song.id %}" class="card-link">{{song.title}}  </a><br>
                    <small style = "float:right;">
                        <form method = "post" action = "{% url 'playlist_songdelete' playlist.id song.id %}">
                            {% csrf_token %}
                            <button type = "Submit">x</button>
                        </form>
                    </small>
                </span>

                <label>Link:</label><textarea readonly="">{{song.link}}</textarea>
                <div>Added:<small>{{song.date_created}}</small></small>
            </div>
        {% endfor %}
        </div>

</div>

{% block js %}

    <script>
Song_Detail_URL = " {% url 'playlist_songdelete' 34578 2378486 %}"; // url for editing song detail
Song_Delete_URL = " {% url 'playlist_songdetail' 56989 9999999 %}"; // url for deleting song
crsf_token = "{% csrf_token %}";
        /*             AJAX Add For Songs                 */
        playlist_id = "{{playlist.id}}";
        Playlist_Detail_Songs = "{% url 'playlist_songs' 11111111 %}"; // add songs to playlist
        proper_url = Playlist_Detail_Songs.replace('11111111',playlist_id);
        $(document).on('submit','#addsong', function(e){
            e.preventDefault();
                $.ajax({
                    method: 'POST',
                    url: proper_url,
                    data: $(this).serialize() 
                  }).done(function(response){
                song_detail_url = Song_Detail_URL.replace(34578, playlist_id); // playlist ID 
                song_detail_url = Song_Detail_URL.replace(2378486, response.id); // 
                song_detail_url = Song_Delete_URL.replace(56989, playlist_id); // playlist ID 
                song_detail_url = Song_Delete_URL.replace(9999999, response.id); //
                var content_to_prepend ="<div class='card-block'>"
                        + "<span><a href='"+Song_Detail_URL.replace(2378486, response.id)+"' class = 'card-link'>"+response.title+"</a><br>"
                        + "<small style = 'float:right;'>"
                        + "<form method = 'post' action = '"+Song_Delete_URL.replace(9999999, response.id)+"' >" + crsf_token
                        + "<button type = 'Submit'>x</button>"
                        + "</form></small></span>"
                        + "<label>Link:</label><textarea readonly=''>"+response.link+"</textarea>"
                        + "<div>Added:<small>" +response.date_created+ "</small></small>"
                        + "</div>";
                 $( "#songlist" ).prepend(content_to_prepend);
              });   
        });
        /*             AJAX Add For Songs                 */
        </script>

{% endblock %}

{% endblock %}